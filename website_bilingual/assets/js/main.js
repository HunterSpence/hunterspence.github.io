
function trapFocus(container){const s=['a[href]','area[href]','input:not([disabled])','select:not([disabled])','textarea:not([disabled])','button:not([disabled])','[tabindex]:not([tabindex="-1"])'];const n=Array.from(container.querySelectorAll(s.join(','))).filter(el=>el.offsetParent!==null);if(!n.length)return()=>{};let f=n[0],l=n[n.length-1];function h(e){if(e.key!=='Tab')return;if(e.shiftKey&&document.activeElement===f){e.preventDefault();l.focus()}else if(!e.shiftKey&&document.activeElement===l){e.preventDefault();f.focus()}}container.addEventListener('keydown',h);return()=>container.removeEventListener('keydown',h)}
const nav=document.querySelector('nav');const navBtn=document.querySelector('.nav-toggle');if(nav&&navBtn){navBtn.addEventListener('click',()=>{const open=nav.getAttribute('data-open')==='true';nav.setAttribute('data-open',String(!open));navBtn.setAttribute('aria-expanded',String(!open));});}
const openModalBtn=document.querySelector('[data-open-modal]');const modalBackdrop=document.querySelector('.modal-backdrop');const modal=document.querySelector('.modal');const closeModalBtn=document.querySelector('[data-close-modal]');let restoreFocus=null;let untrap=()=>{};
function openModal(){if(!modalBackdrop||!modal)return;modalBackdrop.setAttribute('data-open','true');modal.setAttribute('aria-hidden','false');restoreFocus=document.activeElement;const focusable=modal.querySelector('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');(focusable||modal).focus();untrap=trapFocus(modal);}
function closeModal(){if(!modalBackdrop||!modal)return;modalBackdrop.setAttribute('data-open','false');modal.setAttribute('aria-hidden','true');untrap();if(restoreFocus&&restoreFocus.focus)restoreFocus.focus();}
if(openModalBtn&&modal&&modalBackdrop){openModalBtn.addEventListener('click',()=>openModal());}
if(closeModalBtn){closeModalBtn.addEventListener('click',()=>closeModal());}
document.addEventListener('keydown',(e)=>{if(e.key==='Escape'&&modalBackdrop&&modalBackdrop.getAttribute('data-open')==='true'){closeModal();}});
const tablists=document.querySelectorAll('.tablist');tablists.forEach((tl)=>{const tabs=tl.querySelectorAll('[role="tab"]');const panels=tl.parentElement.querySelectorAll('[role="tabpanel"]');function activateTab(tab){tabs.forEach(t=>{t.setAttribute('aria-selected','false');t.setAttribute('tabindex','-1');});panels.forEach(p=>p.dataset.active='false');tab.setAttribute('aria-selected','true');tab.setAttribute('tabindex','0');const id=tab.getAttribute('aria-controls');const panel=document.getElementById(id);if(panel)panel.dataset.active='true';tab.focus();}
tabs.forEach((tab,i)=>{tab.addEventListener('click',()=>activateTab(tab));tab.addEventListener('keydown',(e)=>{let idx=Array.from(tabs).indexOf(document.activeElement);if(e.key==='ArrowRight'){e.preventDefault();activateTab(tabs[(idx+1)%tabs.length]);}if(e.key==='ArrowLeft'){e.preventDefault();activateTab(tabs[(idx-1+tabs.length)%tabs.length]);}});});const first=tabs[0];if(first)activateTab(first);});
const form=document.getElementById('contact-form');const live=document.getElementById('form-live');if(form&&live){form.addEventListener('submit',(e)=>{if(!form.checkValidity()){e.preventDefault();const firstInvalid=form.querySelector(':invalid');if(firstInvalid){const label=form.querySelector(`label[for="${firstInvalid.id}"]`);const name=(label&&label.textContent.trim())||firstInvalid.name||'Field';live.textContent=`${name}: please correct the value.`;firstInvalid.focus();}else{live.textContent='Please correct the highlighted fields.';}}else{e.preventDefault();live.textContent='Form looks valid! (Demo prevents actual submit.)';}});}
